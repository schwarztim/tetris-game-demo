(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const h={left:["ArrowLeft","KeyA"],right:["ArrowRight","KeyD"],softDrop:["ArrowDown","KeyS"],hardDrop:["Space"],rotateCCW:["KeyZ"],rotateCW:["KeyX","ArrowUp","KeyW"],hold:["KeyC","ShiftLeft"],pause:["Escape","KeyP"],restart:["KeyR"]};function Ne(){const e={down:new Set,pressed:new Set,released:new Set};function t(a){["ArrowLeft","ArrowRight","ArrowDown","ArrowUp","Space"].includes(a.code)&&a.preventDefault(),e.down.has(a.code)||e.pressed.add(a.code),e.down.add(a.code)}function n(a){e.down.delete(a.code),e.released.add(a.code)}window.addEventListener("keydown",t,{passive:!1}),window.addEventListener("keyup",n);function c(){e.pressed.clear(),e.released.clear()}function o(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}return{state:e,beginFrame:c,destroy:o}}function T(e,t){return t.some(n=>e.pressed.has(n))}function j(e,t){return t.some(n=>e.down.has(n))}const _=10,q=20,ye=-2,Ce=["I","O","T","S","Z","J","L"],W={I:"#4de8ff",O:"#ffe55c",T:"#b46bff",S:"#54ff8a",Z:"#ff4d6d",J:"#4d7dff",L:"#ff9a4d"},_e={1:100,2:300,3:500,4:800};function Me(e){const c=Math.pow(.85,Math.max(0,e-1));return Math.max(80,Math.floor(1e3*c))}function Re(){const e=[];for(let t=0;t<q;t++){const n=[];for(let c=0;c<_;c++)n.push(0);e.push(n)}return e}function xe(e,t){return t>=0&&t<_&&e<q}function Oe(e,t,n,c){!xe(t,n)||t<0||(e[t][n]=c)}function Ve(e,t){for(const n of t)Oe(e,n.r,n.c,n.t)}function qe(e){let t=0;const n=[];for(let c=q-1;c>=0;c--){const o=e[c];o.every(r=>r!==0)?t++:n.unshift(o.slice())}for(;n.length<q;){const c=[];for(let o=0;o<_;o++)c.push(0);n.unshift(c)}return{board:n,cleared:t}}class De{bag=[];next(){return this.bag.length===0&&(this.bag=$e(Ce.slice())),this.bag.pop()}}function $e(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}const Ge={I:[{r:1,c:0},{r:1,c:1},{r:1,c:2},{r:1,c:3}],O:[{r:1,c:1},{r:1,c:2},{r:2,c:1},{r:2,c:2}],T:[{r:1,c:1},{r:2,c:0},{r:2,c:1},{r:2,c:2}],S:[{r:1,c:1},{r:1,c:2},{r:2,c:0},{r:2,c:1}],Z:[{r:1,c:0},{r:1,c:1},{r:2,c:1},{r:2,c:2}],J:[{r:1,c:0},{r:2,c:0},{r:2,c:1},{r:2,c:2}],L:[{r:1,c:2},{r:2,c:0},{r:2,c:1},{r:2,c:2}]};function D(e,t,n,c){return Ge[e].map(({r:a,c:r})=>{const s=Pe(a,r,t);return{r:n+s.r,c:c+s.c,t:e}})}function Pe(e,t,n){switch(n){case 0:return{r:e,c:t};case 1:return{r:t,c:3-e};case 2:return{r:3-e,c:3-t};case 3:return{r:3-t,c:e}}}const Ie={"0>1":[{r:0,c:0},{r:0,c:-1},{r:1,c:-1},{r:-2,c:0},{r:-2,c:-1}],"1>0":[{r:0,c:0},{r:0,c:1},{r:-1,c:1},{r:2,c:0},{r:2,c:1}],"1>2":[{r:0,c:0},{r:0,c:1},{r:-1,c:1},{r:2,c:0},{r:2,c:1}],"2>1":[{r:0,c:0},{r:0,c:-1},{r:1,c:-1},{r:-2,c:0},{r:-2,c:-1}],"2>3":[{r:0,c:0},{r:0,c:1},{r:1,c:1},{r:-2,c:0},{r:-2,c:1}],"3>2":[{r:0,c:0},{r:0,c:-1},{r:-1,c:-1},{r:2,c:0},{r:2,c:-1}],"3>0":[{r:0,c:0},{r:0,c:-1},{r:-1,c:-1},{r:2,c:0},{r:2,c:-1}],"0>3":[{r:0,c:0},{r:0,c:1},{r:1,c:1},{r:-2,c:0},{r:-2,c:1}]},He={"0>1":[{r:0,c:0},{r:0,c:-2},{r:0,c:1},{r:1,c:-2},{r:-2,c:1}],"1>0":[{r:0,c:0},{r:0,c:2},{r:0,c:-1},{r:-1,c:2},{r:2,c:-1}],"1>2":[{r:0,c:0},{r:0,c:-1},{r:0,c:2},{r:-2,c:-1},{r:1,c:2}],"2>1":[{r:0,c:0},{r:0,c:1},{r:0,c:-2},{r:2,c:1},{r:-1,c:-2}],"2>3":[{r:0,c:0},{r:0,c:2},{r:0,c:-1},{r:1,c:2},{r:-2,c:-1}],"3>2":[{r:0,c:0},{r:0,c:-2},{r:0,c:1},{r:-1,c:-2},{r:2,c:1}],"3>0":[{r:0,c:0},{r:0,c:1},{r:0,c:-2},{r:-2,c:1},{r:1,c:-2}],"0>3":[{r:0,c:0},{r:0,c:-1},{r:0,c:2},{r:2,c:-1},{r:-1,c:2}]};function Ke(e,t,n){if(e==="O")return[{r:0,c:0}];const c=`${t}>${n}`;return(e==="I"?He[c]:Ie[c])??[{r:0,c:0}]}function ie(e){const t=new De,n=[];for(let a=0;a<5;a++)n.push(t.next());const c=ce(n,t),o=performance.now();return{mode:e,status:"playing",board:Re(),rng:t,active:c,hold:null,holdUsed:!1,queue:n,score:0,lines:0,level:1,startMs:o,elapsedMs:0,gravityMs:Me(1),dropAccMs:0,lockAccMs:0,lockDelayMs:500,goalLines:e==="sprint40"?40:0,timeLimitMs:e==="ultra2m"?2*6e4:0,lastClear:{lines:0,tetris:!1}}}function ce(e,t){for(;e.length<5;)e.push(t.next());const n=e.shift(),c=Math.floor(_/2)-2;return{t:n,r:ye,c,rot:0}}function Be(e){let t=e.active.r;for(;L(e,{...e.active,r:t+1});)t++;return{...e.active,r:t}}function le(e,t){if(e.status!=="playing")return;if(e.elapsedMs=performance.now()-e.startMs,e.timeLimitMs&&e.elapsedMs>=e.timeLimitMs){e.status="over";return}e.dropAccMs+=t;const n=e.gravityMs;for(;e.dropAccMs>=n&&(e.dropAccMs-=n,!!We(e)););}function Fe(e,t){e.status!=="over"&&(e.status=t?"paused":"playing",t||(e.dropAccMs=0,e.lockAccMs=0))}function C(e,t){if(e.status!=="playing")return!1;const n={...e.active,c:e.active.c+t};return L(e,n)?(e.active=n,e.lockAccMs=0,!0):!1}function de(e,t){if(e.status!=="playing")return!1;const n=e.active.rot,c=(n+t+4)%4;for(const o of Ke(e.active.t,n,c)){const a={...e.active,rot:c,r:e.active.r+o.r,c:e.active.c+o.c};if(L(e,a))return e.active=a,e.lockAccMs=0,!0}return!1}function Ue(e){if(e.status!=="playing")return;let t=0;for(;L(e,{...e.active,r:e.active.r+1});)e.active={...e.active,r:e.active.r+1},t++;t>0&&(e.score+=t*2),oe(e)}function We(e,t=!1){const n={...e.active,r:e.active.r+1};return L(e,n)?(e.active=n,t&&(e.score+=1),!0):(e.lockAccMs+=e.gravityMs,e.lockAccMs>=e.lockDelayMs&&oe(e),!1)}function Je(e){if(e.status!=="playing"||e.holdUsed)return;const t=e.active.t;if(e.hold==null)e.hold=t,e.active=ce(e.queue,e.rng);else{const n=e.hold;if(e.hold=t,e.active={t:n,r:ye,c:Math.floor(_/2)-2,rot:0},!L(e,e.active)){e.status="over";return}}e.holdUsed=!0,e.lockAccMs=0,e.dropAccMs=0}function Ye(e,t){if(e.status!=="playing")return;const n={...e.active,r:e.active.r+1};L(e,n)||(e.lockAccMs+=t,e.lockAccMs>=e.lockDelayMs&&oe(e))}function oe(e){const t=D(e.active.t,e.active.rot,e.active.r,e.active.c);Ve(e.board,t);const n=qe(e.board);if(e.board=n.board,n.cleared>0){const o=(_e[n.cleared]??0)*e.level;if(e.score+=o,e.lines+=n.cleared,e.lastClear={lines:n.cleared,tetris:n.cleared===4},e.mode==="sprint40"&&e.lines>=e.goalLines){e.status="over";return}const a=1+Math.floor(e.lines/10);a!==e.level&&(e.level=a,e.gravityMs=Me(e.level))}else e.lastClear={lines:0,tetris:!1};e.holdUsed=!1,e.lockAccMs=0,e.dropAccMs=0,e.active=ce(e.queue,e.rng),L(e,e.active)||(e.status="over")}function L(e,t){const n=D(t.t,t.rot,t.r,t.c);for(const c of n)if(c.c<0||c.c>=_||c.r>=q||c.r>=0&&e.board[c.r][c.c]!==0)return!1;return!0}function Ze(e,t,n){let c=ie(e);const o=Ne();let a=0,r=performance.now(),s=0,l=0,d=0,i=0;function u(g){const b=Math.min(50,g-r);if(r=g,T(o.state,h.pause)&&Fe(c,c.status!=="paused"),T(o.state,h.restart)&&(c=ie(e)),c.status!=="paused"){T(o.state,h.rotateCW)&&de(c,1)&&n.onRotate?.(),T(o.state,h.rotateCCW)&&de(c,-1)&&n.onRotate?.(),T(o.state,h.hardDrop)&&(Ue(c),n.onHardDrop?.()),T(o.state,h.hold)&&(Je(c),n.onHold?.());const R=j(o.state,h.left),x=j(o.state,h.right);if(R&&!x){if(s+=b,l=0,i=0,T(o.state,h.left)&&C(c,-1)&&n.onMove?.(),s>=t.dasMs){d+=b;const y=Math.max(0,t.arrMs);if(y===0){for(;C(c,-1);)n.onMove?.();d=0}else for(;d>=y&&(d-=y,!!C(c,-1));)n.onMove?.()}}else s=0,d=0;if(x&&!R){if(l+=b,s=0,d=0,T(o.state,h.right)&&C(c,1)&&n.onMove?.(),l>=t.dasMs){i+=b;const y=Math.max(0,t.arrMs);if(y===0){for(;C(c,1);)n.onMove?.();i=0}else for(;i>=y&&(i-=y,!!C(c,1));)n.onMove?.()}}else l=0,i=0;j(o.state,h.softDrop)?le(c,b*2):le(c,b),Ye(c,b),c.lastClear.lines&&(n.onLineClear?.(c.lastClear.lines,c.lastClear.tetris),c.lastClear={lines:0,tetris:!1}),c.status==="over"&&n.onGameOver?.()}o.beginFrame(),a=requestAnimationFrame(u)}a=requestAnimationFrame(u);function v(){cancelAnimationFrame(a),o.destroy()}function w(){return c}return{stop:v,getState:w,getGhost:Be}}const ae="neon-tetris:leaderboard:v1";function Ae(){const e=localStorage.getItem(ae);if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t.sort((n,c)=>c.score-n.score):[]}catch{return[]}}function Xe(e){const t=Ae();t.push(e),t.sort((n,c)=>c.score-n.score),localStorage.setItem(ae,JSON.stringify(t.slice(0,50)))}function je(){localStorage.removeItem(ae)}let m=null,k=null,S=null,U=[],H=0;async function ne(){if(m)return;const e=window.AudioContext||window.webkitAudioContext;m=new e,k=m.createGain(),k.gain.value=.7,k.connect(m.destination),S=m.createGain(),S.gain.value=.35,S.connect(k),m.state==="suspended"&&await m.resume()}function K(e){k&&(k.gain.value=Qe(e,0,1))}function B(){if(!m||!S)return;M();const t=60/150,n=m.currentTime+.05,c=["E5","B4","C5","D5","C5","B4","A4","A4","C5","E5","D5","C5","B4","B4","C5","D5","E5","C5","A4","A4","D5","F5","A5","G5","F5","E5","C5","E5","D5","C5","B4","B4"],o=["E3","E3","E3","E3","A2","A2","A2","A2","D3","D3","D3","D3","G2","G2","G2","G2"],a=["E4","G4","B4"],r=me("square",.18),s=me("triangle",.12),l=ze("sine",.06,a.length);U=[r.osc,s.osc,...l.oscs],P(n,t/2,c,(i,u)=>{r.env.gain.setValueAtTime(1e-4,i),r.env.gain.exponentialRampToValueAtTime(.18,i+.01),r.env.gain.exponentialRampToValueAtTime(1e-4,i+t/2-.01),r.osc.frequency.setValueAtTime(u,i)}),P(n,t,o,(i,u)=>{s.env.gain.setValueAtTime(1e-4,i),s.env.gain.exponentialRampToValueAtTime(.12,i+.01),s.env.gain.exponentialRampToValueAtTime(1e-4,i+t-.02),s.osc.frequency.setValueAtTime(u,i)}),a.forEach((i,u)=>{const v=Te(i);l.oscs[u].frequency.setValueAtTime(v,n)}),l.env.gain.setValueAtTime(1e-4,n),l.env.gain.exponentialRampToValueAtTime(.05,n+.2);const d=c.length*(t/2);H=window.setInterval(()=>{if(!m)return;const i=m.currentTime+.05;P(i,t/2,c,(u,v)=>{r.env.gain.setValueAtTime(1e-4,u),r.env.gain.exponentialRampToValueAtTime(.18,u+.01),r.env.gain.exponentialRampToValueAtTime(1e-4,u+t/2-.01),r.osc.frequency.setValueAtTime(v,u)}),P(i,t,o,(u,v)=>{s.env.gain.setValueAtTime(1e-4,u),s.env.gain.exponentialRampToValueAtTime(.12,u+.01),s.env.gain.exponentialRampToValueAtTime(1e-4,u+t-.02),s.osc.frequency.setValueAtTime(v,u)})},d*1e3)}function M(){H&&(clearInterval(H),H=0),U.forEach(e=>{try{e.stop()}catch{}try{e.disconnect()}catch{}}),U=[]}function ue(){return U.length>0}function V(e){if(!m||!k)return;const t=m.currentTime,n=m.createGain();n.gain.value=.18,n.connect(k);const c=m.createOscillator(),o=m.createBiquadFilter();o.type="lowpass",o.frequency.value=1800,c.connect(o),o.connect(n);const a=m.createGain();switch(a.gain.value=1e-4,o.connect(a),a.connect(n),e){case"rotate":c.type="square",c.frequency.setValueAtTime(540,t),c.frequency.exponentialRampToValueAtTime(880,t+.03);break;case"drop":c.type="triangle",c.frequency.setValueAtTime(220,t),c.frequency.exponentialRampToValueAtTime(90,t+.07);break;case"clear":c.type="sawtooth",c.frequency.setValueAtTime(660,t),c.frequency.exponentialRampToValueAtTime(990,t+.08);break;case"tetris":c.type="square",c.frequency.setValueAtTime(880,t),c.frequency.exponentialRampToValueAtTime(1320,t+.12);break;case"hold":c.type="sine",c.frequency.setValueAtTime(420,t),c.frequency.exponentialRampToValueAtTime(300,t+.08);break;case"gameover":c.type="sawtooth",c.frequency.setValueAtTime(330,t),c.frequency.exponentialRampToValueAtTime(55,t+.5),o.frequency.setValueAtTime(1200,t),o.frequency.exponentialRampToValueAtTime(200,t+.5);break}a.gain.setValueAtTime(1e-4,t),a.gain.exponentialRampToValueAtTime(.28,t+.01),a.gain.exponentialRampToValueAtTime(1e-4,t+(e==="gameover"?.55:.12)),c.start(t),c.stop(t+(e==="gameover"?.6:.14))}function me(e,t){if(!m||!S)throw new Error("audio not booted");const n=m.createOscillator();n.type=e;const c=m.createGain();return c.gain.value=1e-4,n.connect(c),c.connect(S),n.start(),{osc:n,env:c,level:t,oscs:[n]}}function ze(e,t,n){if(!m||!S)throw new Error("audio not booted");const c=m.createGain();c.gain.value=1e-4,c.connect(S);const o=[];for(let a=0;a<n;a++){const r=m.createOscillator();r.type=e,r.connect(c),r.start(),o.push(r)}return{oscs:o,env:c,level:t}}function P(e,t,n,c){for(let o=0;o<n.length;o++)c(e+o*t,Te(n[o]))}function Te(e){const t=/^([A-G])(#?)(\d)$/.exec(e);if(!t)return 440;const n=t[1],c=t[2]==="#",o=Number(t[3]),a={C:0,D:2,E:4,F:5,G:7,A:9,B:11},r=440;let s=a[n]+(c?1:0);const l=(o+1)*12+s;return r*Math.pow(2,(l-69)/12)}function Qe(e,t,n){return Math.max(t,Math.min(n,e))}const et="/tetris-game-demo/assets/menumusic-DFLpY1NM.mp3",tt="/tetris-game-demo/assets/gamemusic-CGtAdK-L.mp3";let E=null,fe=null;function F(e,t){if(e==="synth")return;if(e==="off"){A();return}const n=e==="menu_mp3"?et:tt;E||(E=new Audio,E.loop=!0,E.preload="auto"),E.volume=nt(t,0,1),fe!==n&&(fe=n,E.src=n),E.play().catch(()=>{})}function A(){if(E)try{E.pause()}catch{}}function pe(){return E&&!E.paused}function nt(e,t,n){return Math.max(t,Math.min(n,e))}function ct({router:e,settings:t}){const n=document.createElement("div");n.className=`screen game theme--${t.theme}`;const c=document.createElement("div");c.className="game__header",c.innerHTML=`
    <div class="brand">NEON TETRIS</div>
    <div class="meta">Z/X rotate · C hold · Space hard drop · Esc pause</div>
  `;const o=document.createElement("div");o.className="game__layout";const a=document.createElement("div");a.className="side";const r=document.createElement("div");r.className="side";const s=document.createElement("div");s.className="center";const l=document.createElement("div");l.className="board-wrap";const d=document.createElement("canvas");d.width=420,d.height=840,d.className="board";const i=document.createElement("div");i.className="overlay",l.append(d,i),s.append(l);const u=document.createElement("div");u.className="hud";const v=document.createElement("div");v.className="stats";const w=I("Score"),g=I("Lines"),b=I("Level"),R=I("Time");v.append(w.el,g.el,b.el,R.el);const x=ve("Hold"),y=ve("Next");a.append(x.el,v),r.append(y.el);const Y=document.createElement("div");Y.className="controls";const $=document.createElement("button");$.className="btn",$.textContent="Menu",$.addEventListener("click",()=>{M(),A(),N.stop(),e.go("menu")});const G=document.createElement("button");G.className="btn",G.textContent="Restart",G.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR"}))});const O=document.createElement("button");O.className="btn",O.textContent=t.musicEnabled||t.sfxEnabled?"Audio: On":"Audio: Off",O.addEventListener("click",()=>{if(t.musicEnabled=!t.musicEnabled,t.sfxEnabled=t.musicEnabled,O.textContent=t.musicEnabled?"Audio: On":"Audio: Off",!t.musicEnabled){M(),A();return}const f=t.volume/100;t.musicTrack==="synth"?(A(),K(f),B()):(M(),F("game_mp3",f))}),Y.append($,G,O),u.append(v,Y),o.append(a,s,r),n.append(c,o);const Z=d.getContext("2d"),N=Ze(t.mode,{dasMs:t.das,arrMs:t.arr},{onLineClear(f,p){t.sfxEnabled&&V(p?"tetris":"clear"),Le(p?"TETRIS!":`${f} LINE${f>1?"S":""}`)},onHardDrop(){t.sfxEnabled&&V("drop")},onRotate(){t.sfxEnabled&&V("rotate")},onMove(){},onHold(){t.sfxEnabled&&V("hold")},onGameOver(){t.sfxEnabled&&V("gameover"),Se()}});(async()=>{if(await ne(),M(),A(),!t.musicEnabled)return;const f=t.volume/100;t.musicTrack==="synth"?(K(f),B()):F("game_mp3",f)})();let X=0;function re(f){const p=N.getState();if(p.__ghost=N.getGhost(p),w.value.textContent=String(p.score),g.value.textContent=String(p.lines),b.value.textContent=String(p.level),R.value.textContent=we(p.elapsedMs),x.draw(p.hold),y.draw(p.queue.slice(0,5)),i.classList.toggle("overlay--paused",p.status==="paused"),ot(Z,p.board),at(Z,p),rt(Z,p),p.status==="paused")i.innerHTML='<div class="overlay__card"><div class="overlay__title">PAUSED</div><div class="overlay__sub">Press Esc to resume</div></div>',ue()&&M(),pe()&&A();else if(p.status!=="over"){if(t.musicEnabled){const se=t.volume/100;t.musicTrack==="synth"?ue()||(K(se),B()):pe()||(M(),F("game_mp3",se))}i.dataset.locked||(i.innerHTML="")}X=requestAnimationFrame(re)}function Se(){i.dataset.locked="1";const f=N.getState();i.innerHTML=`
      <div class="overlay__card">
        <div class="overlay__title">GAME OVER</div>
        <div class="overlay__sub">Score ${f.score} · Lines ${f.lines} · ${we(f.elapsedMs)}</div>
        <div class="overlay__actions">
          <button class="btn btn--primary" data-action="submit">Submit Score</button>
          <button class="btn" data-action="again">Play Again</button>
          <button class="btn" data-action="menu">Menu</button>
        </div>
      </div>
    `,i.querySelector('[data-action="again"]').addEventListener("click",()=>{i.dataset.locked="",window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR"}))}),i.querySelector('[data-action="menu"]').addEventListener("click",()=>{M(),A(),N.stop(),e.go("menu")}),i.querySelector('[data-action="submit"]').addEventListener("click",()=>{const p=prompt("Name for leaderboard?","PLAYER")?.slice(0,16)??"PLAYER";Xe({name:p||"PLAYER",mode:f.mode,score:f.score,lines:f.lines,durationMs:Math.floor(f.elapsedMs),createdAt:Date.now()}),e.go("leaderboard")})}function Le(f){i.dataset.locked||(i.innerHTML=`<div class="toast">${f}</div>`,i.classList.remove("overlay--toast"),i.offsetWidth,i.classList.add("overlay--toast"),setTimeout(()=>{i.dataset.locked||(i.innerHTML="",i.classList.remove("overlay--toast"))},900))}return X=requestAnimationFrame(re),window.addEventListener("beforeunload",()=>{cancelAnimationFrame(X),N.stop(),M(),A()}),n}function I(e){const t=document.createElement("div");t.className="stat";const n=document.createElement("div");n.className="stat__label",n.textContent=e;const c=document.createElement("div");return c.className="stat__value",c.textContent="0",t.append(n,c),{el:t,value:c}}function ve(e){const t=document.createElement("div");t.className="mini";const n=document.createElement("div");n.className="mini__title",n.textContent=e;const c=document.createElement("canvas");c.width=180,c.height=240,c.className="mini__canvas";const o=c.getContext("2d");t.append(n,c);function a(s){o.clearRect(0,0,c.width,c.height),s&&be(o,s,0,0)}function r(s){o.clearRect(0,0,c.width,c.height),s.forEach((l,d)=>be(o,l,0,d*80))}return{el:t,draw(s){Array.isArray(s)?r(s):a(s)}}}function be(e,t,n,c){const o=D(t,0,0,0),a=Math.min(...o.map(i=>i.r)),r=Math.min(...o.map(i=>i.c)),s=24,l=n+18,d=c+18;for(const i of o){const u=i.r-a,v=i.c-r;J(e,l+v*s,d+u*s,s,W[t],.9)}}function ot(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height);const n=e.canvas.width/10;e.save(),e.globalAlpha=.2;for(let c=0;c<20;c++)for(let o=0;o<10;o++)e.strokeStyle="rgba(255,255,255,0.12)",e.strokeRect(o*n+.5,c*n+.5,n-1,n-1);e.restore();for(let c=0;c<20;c++)for(let o=0;o<10;o++){const a=t[c][o];a&&J(e,o*n,c*n,n,W[a],1)}}function at(e,t){const n=e.canvas.width/10,c=t.__ghost;if(!c)return;const o=D(c.t,c.rot,c.r,c.c);for(const a of o)a.r<0||J(e,a.c*n,a.r*n,n,W[c.t],.25)}function rt(e,t){const n=e.canvas.width/10,c=t.active.t,o=D(c,t.active.rot,t.active.r,t.active.c);for(const a of o)a.r<0||J(e,a.c*n,a.r*n,n,W[c],1)}function J(e,t,n,c,o,a){e.save(),e.globalAlpha=a,e.shadowColor=o,e.shadowBlur=18;const r=2,s=c-r*2,l=e.createLinearGradient(t,n,t+c,n+c);l.addColorStop(0,Ee(o,1.2)),l.addColorStop(1,Ee(o,.9)),e.fillStyle=l,he(e,t+r,n+r,s,s,8),e.fill(),e.shadowBlur=0,e.strokeStyle="rgba(255,255,255,0.28)",e.lineWidth=1,he(e,t+r+.5,n+r+.5,s-1,s-1,8),e.stroke(),e.restore()}function he(e,t,n,c,o,a){e.beginPath(),e.moveTo(t+a,n),e.arcTo(t+c,n,t+c,n+o,a),e.arcTo(t+c,n+o,t,n+o,a),e.arcTo(t,n+o,t,n,a),e.arcTo(t,n,t+c,n,a),e.closePath()}function Ee(e,t){const n=e.replace("#",""),c=z(Math.floor(parseInt(n.slice(0,2),16)*t),0,255),o=z(Math.floor(parseInt(n.slice(2,4),16)*t),0,255),a=z(Math.floor(parseInt(n.slice(4,6),16)*t),0,255);return`rgb(${c},${o},${a})`}function z(e,t,n){return Math.max(t,Math.min(n,e))}function we(e){const t=Math.max(0,Math.floor(e/1e3)),n=Math.floor(t/60),c=t%60;return`${n}:${String(c).padStart(2,"0")}`}function st({router:e,settings:t}){const n=document.createElement("div");n.className="screen menu",(async()=>{if(await ne(),M(),A(),!t.musicEnabled)return;const d=t.volume/100;t.musicTrack==="synth"?(K(d),B()):F("menu_mp3",d)})();const c=document.createElement("div");c.className="title",c.innerHTML=`
    <div class="title__top">NEON</div>
    <div class="title__main">TETRIS</div>
    <div class="title__sub">Production build · modes · audio · leaderboard</div>
  `;const o=document.createElement("div");o.className="panel";const a=document.createElement("button");a.className="btn btn--primary",a.textContent="PLAY",a.addEventListener("click",async()=>{await ne(),e.go("game")});const r=document.createElement("button");r.className="btn",r.textContent="OPTIONS",r.addEventListener("click",()=>e.go("settings"));const s=document.createElement("button");s.className="btn",s.textContent="LEADERBOARD",s.addEventListener("click",()=>e.go("leaderboard"));const l=document.createElement("div");return l.className="hint",l.innerHTML=`
    <div class="kbd">
      <div><span>Move</span><kbd>←</kbd><kbd>→</kbd></div>
      <div><span>Rotate</span><kbd>Z</kbd><kbd>X</kbd></div>
      <div><span>Soft/Hard</span><kbd>↓</kbd><kbd>Space</kbd></div>
      <div><span>Hold</span><kbd>C</kbd></div>
      <div><span>Pause</span><kbd>Esc</kbd></div>
    </div>
    <div class="small">Tip: click PLAY once to enable audio in-browser.</div>
  `,o.append(a,r,s),n.append(c,o,l),n}const ke="neon-tetris:settings:v1";function it(){const e=localStorage.getItem(ke);if(!e)return Q();try{const t=JSON.parse(e);return{...Q(),...t}}catch{return Q()}}function lt(e){localStorage.setItem(ke,JSON.stringify(e))}function Q(){return{mode:"marathon",theme:"neon",musicEnabled:!0,musicTrack:"synth",sfxEnabled:!0,volume:70,das:120,arr:20}}function dt({router:e,settings:t}){const n=document.createElement("div");n.className="screen settings";const c=document.createElement("h2");c.textContent="Options";const o=document.createElement("div");o.className="form";const a=ee("Mode",[{value:"marathon",label:"Marathon (recommended)"},{value:"sprint40",label:"Sprint 40 lines"},{value:"ultra2m",label:"Ultra 2 minutes"}]);a.value=t.mode;const r=ee("Theme",[{value:"neon",label:"Neon"},{value:"aurora",label:"Aurora"},{value:"mono",label:"Mono"}]);r.value=t.theme;const s=ge("Music",t.musicEnabled),l=ee("Music track",[{value:"synth",label:"Synth (built-in)"},{value:"menu_mp3",label:"Menu MP3"},{value:"game_mp3",label:"Game MP3"}]);l.value=t.musicTrack;const d=ge("SFX",t.sfxEnabled),i=te("Volume",0,100,t.volume,1),u=te("DAS (ms)",50,250,t.das,1),v=te("ARR (ms)",0,60,t.arr,1),w=document.createElement("button");w.className="btn",w.textContent="Back",w.addEventListener("click",()=>e.go("menu"));const g=document.createElement("button");g.className="btn btn--primary",g.textContent="Save",g.addEventListener("click",()=>{t.mode=a.value,t.theme=r.value,t.musicEnabled=s.input.checked,t.musicTrack=l.value,t.sfxEnabled=d.input.checked,t.volume=Number(i.value),t.das=Number(u.value),t.arr=Number(v.value),lt(t),e.go("menu")}),o.append(a.row,r.row,s.row,l.row,d.row,i.row,u.row,v.row);const b=document.createElement("div");return b.className="footer",b.append(w,g),n.append(c,o,b),n}function ee(e,t){const n=document.createElement("div");n.className="row";const c=document.createElement("div");c.className="row__label",c.textContent=e;const o=document.createElement("select");o.className="select";for(const a of t){const r=document.createElement("option");r.value=a.value,r.textContent=a.label,o.append(r)}return n.append(c,o),Object.assign(o,{row:n})}function ge(e,t){const n=document.createElement("div");n.className="row";const c=document.createElement("div");c.className="row__label",c.textContent=e;const o=document.createElement("input");o.type="checkbox",o.checked=t;const a=document.createElement("label");return a.className="toggle",a.append(o,document.createElement("span")),n.append(c,a),{row:n,input:o}}function te(e,t,n,c,o){const a=document.createElement("div");a.className="row";const r=document.createElement("div");r.className="row__label",r.textContent=e;const s=document.createElement("input");s.type="range",s.min=String(t),s.max=String(n),s.step=String(o),s.value=String(c);const l=document.createElement("div");return l.className="row__value",l.textContent=String(c),s.addEventListener("input",()=>l.textContent=s.value),a.append(r,s,l),Object.assign(s,{row:a})}function ut({router:e}){const t=document.createElement("div");t.className="screen leaderboard";const n=document.createElement("h2");n.textContent="Leaderboard";const c=document.createElement("div");c.className="table";const o=Ae(),a=document.createElement("div");if(a.className="table__row table__row--header",a.innerHTML="<div>#</div><div>Name</div><div>Mode</div><div>Score</div><div>Lines</div><div>Time</div>",c.append(a),o.slice(0,10).forEach((d,i)=>{const u=document.createElement("div");u.className="table__row",u.innerHTML=`<div>${i+1}</div><div>${ft(d.name)}</div><div>${d.mode}</div><div>${d.score}</div><div>${d.lines}</div><div>${mt(d.durationMs)}</div>`,c.append(u)}),o.length===0){const d=document.createElement("div");d.className="empty",d.textContent="No scores yet. Play a game to set your first record.",c.append(d)}const r=document.createElement("div");r.className="footer";const s=document.createElement("button");s.className="btn",s.textContent="Back",s.addEventListener("click",()=>e.go("menu"));const l=document.createElement("button");return l.className="btn",l.textContent="Reset",l.addEventListener("click",()=>{je(),e.go("leaderboard")}),r.append(s,l),t.append(n,c,r),t}function mt(e){const t=Math.max(0,Math.floor(e/1e3)),n=Math.floor(t/60),c=t%60;return`${n}:${String(c).padStart(2,"0")}`}function ft(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function pt(e){let t="menu";const n="/tetris-game-demo/".replace(/\/$/,"");function c(o){t=o;const a=o==="menu"?`${n}/`:`${n}/${o}`;history.pushState({route:o},"",a),e.mount(o)}return window.addEventListener("popstate",o=>{const a=location.pathname.replace(n,"").replace(/^\//,""),r=(o.state?.route??(a||"menu"))||"menu";t=r,e.mount(r)}),{go:c,get current(){return t}}}function vt(e){e.innerHTML="",e.classList.add("app-root");const t=it(),n=document.createElement("div");n.className="app-shell";const c=document.createElement("div");c.className="bg";const o=document.createElement("div");o.className="crt";const a=document.createElement("div");a.className="view",n.append(c,o,a),e.append(n);const r=pt({mount(s){switch(a.innerHTML="",s){case"menu":a.append(st({router:r,settings:t}));break;case"game":a.append(ct({router:r,settings:t}));break;case"settings":a.append(dt({router:r,settings:t}));break;case"leaderboard":a.append(ut({router:r}));break}}});r.go("menu")}vt(document.querySelector("#app"));
