(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function c(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=c(o);fetch(o.href,a)}})();const h={left:["ArrowLeft","KeyA"],right:["ArrowRight","KeyD"],softDrop:["ArrowDown","KeyS"],hardDrop:["Space"],rotateCCW:["KeyZ"],rotateCW:["KeyX","ArrowUp","KeyW"],hold:["KeyC","ShiftLeft"],pause:["Escape","KeyP"],restart:["KeyR"]};function ke(){const e={down:new Set,pressed:new Set,released:new Set};function t(a){["ArrowLeft","ArrowRight","ArrowDown","ArrowUp","Space"].includes(a.code)&&a.preventDefault(),e.down.has(a.code)||e.pressed.add(a.code),e.down.add(a.code)}function c(a){e.down.delete(a.code),e.released.add(a.code)}window.addEventListener("keydown",t,{passive:!1}),window.addEventListener("keyup",c);function n(){e.pressed.clear(),e.released.clear()}function o(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",c)}return{state:e,beginFrame:n,destroy:o}}function M(e,t){return t.some(c=>e.pressed.has(c))}function J(e,t){return t.some(c=>e.down.has(c))}const _=10,q=20,Ee=-2,Se=["I","O","T","S","Z","J","L"],K={I:"#4de8ff",O:"#ffe55c",T:"#b46bff",S:"#54ff8a",Z:"#ff4d6d",J:"#4d7dff",L:"#ff9a4d"},Le={1:100,2:300,3:500,4:800};function we(e){const n=Math.pow(.85,Math.max(0,e-1));return Math.max(80,Math.floor(1e3*n))}function Ne(){const e=[];for(let t=0;t<q;t++){const c=[];for(let n=0;n<_;n++)c.push(0);e.push(c)}return e}function Ce(e,t){return t>=0&&t<_&&e<q}function _e(e,t,c,n){!Ce(t,c)||t<0||(e[t][c]=n)}function Re(e,t){for(const c of t)_e(e,c.r,c.c,c.t)}function xe(e){let t=0;const c=[];for(let n=q-1;n>=0;n--){const o=e[n];o.every(r=>r!==0)?t++:c.unshift(o.slice())}for(;c.length<q;){const n=[];for(let o=0;o<_;o++)n.push(0);c.unshift(n)}return{board:c,cleared:t}}class Oe{bag=[];next(){return this.bag.length===0&&(this.bag=Ve(Se.slice())),this.bag.pop()}}function Ve(e){for(let t=e.length-1;t>0;t--){const c=Math.floor(Math.random()*(t+1));[e[t],e[c]]=[e[c],e[t]]}return e}const qe={I:[{r:1,c:0},{r:1,c:1},{r:1,c:2},{r:1,c:3}],O:[{r:1,c:1},{r:1,c:2},{r:2,c:1},{r:2,c:2}],T:[{r:1,c:1},{r:2,c:0},{r:2,c:1},{r:2,c:2}],S:[{r:1,c:1},{r:1,c:2},{r:2,c:0},{r:2,c:1}],Z:[{r:1,c:0},{r:1,c:1},{r:2,c:1},{r:2,c:2}],J:[{r:1,c:0},{r:2,c:0},{r:2,c:1},{r:2,c:2}],L:[{r:1,c:2},{r:2,c:0},{r:2,c:1},{r:2,c:2}]};function D(e,t,c,n){return qe[e].map(({r:a,c:r})=>{const s=De(a,r,t);return{r:c+s.r,c:n+s.c,t:e}})}function De(e,t,c){switch(c){case 0:return{r:e,c:t};case 1:return{r:t,c:3-e};case 2:return{r:3-e,c:3-t};case 3:return{r:3-t,c:e}}}const Ge={"0>1":[{r:0,c:0},{r:0,c:-1},{r:1,c:-1},{r:-2,c:0},{r:-2,c:-1}],"1>0":[{r:0,c:0},{r:0,c:1},{r:-1,c:1},{r:2,c:0},{r:2,c:1}],"1>2":[{r:0,c:0},{r:0,c:1},{r:-1,c:1},{r:2,c:0},{r:2,c:1}],"2>1":[{r:0,c:0},{r:0,c:-1},{r:1,c:-1},{r:-2,c:0},{r:-2,c:-1}],"2>3":[{r:0,c:0},{r:0,c:1},{r:1,c:1},{r:-2,c:0},{r:-2,c:1}],"3>2":[{r:0,c:0},{r:0,c:-1},{r:-1,c:-1},{r:2,c:0},{r:2,c:-1}],"3>0":[{r:0,c:0},{r:0,c:-1},{r:-1,c:-1},{r:2,c:0},{r:2,c:-1}],"0>3":[{r:0,c:0},{r:0,c:1},{r:1,c:1},{r:-2,c:0},{r:-2,c:1}]},Ie={"0>1":[{r:0,c:0},{r:0,c:-2},{r:0,c:1},{r:1,c:-2},{r:-2,c:1}],"1>0":[{r:0,c:0},{r:0,c:2},{r:0,c:-1},{r:-1,c:2},{r:2,c:-1}],"1>2":[{r:0,c:0},{r:0,c:-1},{r:0,c:2},{r:-2,c:-1},{r:1,c:2}],"2>1":[{r:0,c:0},{r:0,c:1},{r:0,c:-2},{r:2,c:1},{r:-1,c:-2}],"2>3":[{r:0,c:0},{r:0,c:2},{r:0,c:-1},{r:1,c:2},{r:-2,c:-1}],"3>2":[{r:0,c:0},{r:0,c:-2},{r:0,c:1},{r:-1,c:-2},{r:2,c:1}],"3>0":[{r:0,c:0},{r:0,c:1},{r:0,c:-2},{r:-2,c:1},{r:1,c:-2}],"0>3":[{r:0,c:0},{r:0,c:-1},{r:0,c:2},{r:2,c:-1},{r:-1,c:2}]};function Pe(e,t,c){if(e==="O")return[{r:0,c:0}];const n=`${t}>${c}`;return(e==="I"?Ie[n]:Ge[n])??[{r:0,c:0}]}function se(e){const t=new Oe,c=[];for(let a=0;a<5;a++)c.push(t.next());const n=ce(c,t),o=performance.now();return{mode:e,status:"playing",board:Ne(),rng:t,active:n,hold:null,holdUsed:!1,queue:c,score:0,lines:0,level:1,startMs:o,elapsedMs:0,gravityMs:we(1),dropAccMs:0,lockAccMs:0,lockDelayMs:500,goalLines:e==="sprint40"?40:0,timeLimitMs:e==="ultra2m"?2*6e4:0,lastClear:{lines:0,tetris:!1}}}function ce(e,t){for(;e.length<5;)e.push(t.next());const c=e.shift(),n=Math.floor(_/2)-2;return{t:c,r:Ee,c:n,rot:0}}function $e(e){let t=e.active.r;for(;L(e,{...e.active,r:t+1});)t++;return{...e.active,r:t}}function ie(e,t){if(e.status!=="playing")return;if(e.elapsedMs=performance.now()-e.startMs,e.timeLimitMs&&e.elapsedMs>=e.timeLimitMs){e.status="over";return}e.dropAccMs+=t;const c=e.gravityMs;for(;e.dropAccMs>=c&&(e.dropAccMs-=c,!!Be(e)););}function He(e,t){e.status!=="over"&&(e.status=t?"paused":"playing",t||(e.dropAccMs=0,e.lockAccMs=0))}function C(e,t){if(e.status!=="playing")return!1;const c={...e.active,c:e.active.c+t};return L(e,c)?(e.active=c,e.lockAccMs=0,!0):!1}function le(e,t){if(e.status!=="playing")return!1;const c=e.active.rot,n=(c+t+4)%4;for(const o of Pe(e.active.t,c,n)){const a={...e.active,rot:n,r:e.active.r+o.r,c:e.active.c+o.c};if(L(e,a))return e.active=a,e.lockAccMs=0,!0}return!1}function Ke(e){if(e.status!=="playing")return;let t=0;for(;L(e,{...e.active,r:e.active.r+1});)e.active={...e.active,r:e.active.r+1},t++;t>0&&(e.score+=t*2),oe(e)}function Be(e,t=!1){const c={...e.active,r:e.active.r+1};return L(e,c)?(e.active=c,t&&(e.score+=1),!0):(e.lockAccMs+=e.gravityMs,e.lockAccMs>=e.lockDelayMs&&oe(e),!1)}function Fe(e){if(e.status!=="playing"||e.holdUsed)return;const t=e.active.t;if(e.hold==null)e.hold=t,e.active=ce(e.queue,e.rng);else{const c=e.hold;if(e.hold=t,e.active={t:c,r:Ee,c:Math.floor(_/2)-2,rot:0},!L(e,e.active)){e.status="over";return}}e.holdUsed=!0,e.lockAccMs=0,e.dropAccMs=0}function Ue(e,t){if(e.status!=="playing")return;const c={...e.active,r:e.active.r+1};L(e,c)||(e.lockAccMs+=t,e.lockAccMs>=e.lockDelayMs&&oe(e))}function oe(e){const t=D(e.active.t,e.active.rot,e.active.r,e.active.c);Re(e.board,t);const c=xe(e.board);if(e.board=c.board,c.cleared>0){const o=(Le[c.cleared]??0)*e.level;if(e.score+=o,e.lines+=c.cleared,e.lastClear={lines:c.cleared,tetris:c.cleared===4},e.mode==="sprint40"&&e.lines>=e.goalLines){e.status="over";return}const a=1+Math.floor(e.lines/10);a!==e.level&&(e.level=a,e.gravityMs=we(e.level))}else e.lastClear={lines:0,tetris:!1};e.holdUsed=!1,e.lockAccMs=0,e.dropAccMs=0,e.active=ce(e.queue,e.rng),L(e,e.active)||(e.status="over")}function L(e,t){const c=D(t.t,t.rot,t.r,t.c);for(const n of c)if(n.c<0||n.c>=_||n.r>=q||n.r>=0&&e.board[n.r][n.c]!==0)return!1;return!0}function We(e,t,c){let n=se(e);const o=ke();let a=0,r=performance.now(),s=0,l=0,d=0,i=0;function u(w){const b=Math.min(50,w-r);if(r=w,M(o.state,h.pause)&&He(n,n.status!=="paused"),M(o.state,h.restart)&&(n=se(e)),n.status!=="paused"){M(o.state,h.rotateCW)&&le(n,1)&&c.onRotate?.(),M(o.state,h.rotateCCW)&&le(n,-1)&&c.onRotate?.(),M(o.state,h.hardDrop)&&(Ke(n),c.onHardDrop?.()),M(o.state,h.hold)&&(Fe(n),c.onHold?.());const R=J(o.state,h.left),x=J(o.state,h.right);if(R&&!x){if(s+=b,l=0,i=0,M(o.state,h.left)&&C(n,-1)&&c.onMove?.(),s>=t.dasMs){d+=b;const g=Math.max(0,t.arrMs);if(g===0){for(;C(n,-1);)c.onMove?.();d=0}else for(;d>=g&&(d-=g,!!C(n,-1));)c.onMove?.()}}else s=0,d=0;if(x&&!R){if(l+=b,s=0,d=0,M(o.state,h.right)&&C(n,1)&&c.onMove?.(),l>=t.dasMs){i+=b;const g=Math.max(0,t.arrMs);if(g===0){for(;C(n,1);)c.onMove?.();i=0}else for(;i>=g&&(i-=g,!!C(n,1));)c.onMove?.()}}else l=0,i=0;J(o.state,h.softDrop)?ie(n,b*2):ie(n,b),Ue(n,b),n.lastClear.lines&&(c.onLineClear?.(n.lastClear.lines,n.lastClear.tetris),n.lastClear={lines:0,tetris:!1}),n.status==="over"&&c.onGameOver?.()}o.beginFrame(),a=requestAnimationFrame(u)}a=requestAnimationFrame(u);function v(){cancelAnimationFrame(a),o.destroy()}function E(){return n}return{stop:v,getState:E,getGhost:$e}}const ae="neon-tetris:leaderboard:v1";function ge(){const e=localStorage.getItem(ae);if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t.sort((c,n)=>n.score-c.score):[]}catch{return[]}}function Je(e){const t=ge();t.push(e),t.sort((c,n)=>n.score-c.score),localStorage.setItem(ae,JSON.stringify(t.slice(0,50)))}function Ye(){localStorage.removeItem(ae)}let m=null,k=null,S=null,z=[],H=0;async function Q(){if(m)return;const e=window.AudioContext||window.webkitAudioContext;m=new e,k=m.createGain(),k.gain.value=.7,k.connect(m.destination),S=m.createGain(),S.gain.value=.35,S.connect(k),m.state==="suspended"&&await m.resume()}function ee(e){k&&(k.gain.value=Xe(e,0,1))}function te(){if(!m||!S)return;A();const t=60/150,c=m.currentTime+.05,n=["E5","B4","C5","D5","C5","B4","A4","A4","C5","E5","D5","C5","B4","B4","C5","D5","E5","C5","A4","A4","D5","F5","A5","G5","F5","E5","C5","E5","D5","C5","B4","B4"],o=["E3","E3","E3","E3","A2","A2","A2","A2","D3","D3","D3","D3","G2","G2","G2","G2"],a=["E4","G4","B4"],r=de("square",.18),s=de("triangle",.12),l=Ze("sine",.06,a.length);z=[r.osc,s.osc,...l.oscs],P(c,t/2,n,(i,u)=>{r.env.gain.setValueAtTime(1e-4,i),r.env.gain.exponentialRampToValueAtTime(.18,i+.01),r.env.gain.exponentialRampToValueAtTime(1e-4,i+t/2-.01),r.osc.frequency.setValueAtTime(u,i)}),P(c,t,o,(i,u)=>{s.env.gain.setValueAtTime(1e-4,i),s.env.gain.exponentialRampToValueAtTime(.12,i+.01),s.env.gain.exponentialRampToValueAtTime(1e-4,i+t-.02),s.osc.frequency.setValueAtTime(u,i)}),a.forEach((i,u)=>{const v=ye(i);l.oscs[u].frequency.setValueAtTime(v,c)}),l.env.gain.setValueAtTime(1e-4,c),l.env.gain.exponentialRampToValueAtTime(.05,c+.2);const d=n.length*(t/2);H=window.setInterval(()=>{if(!m)return;const i=m.currentTime+.05;P(i,t/2,n,(u,v)=>{r.env.gain.setValueAtTime(1e-4,u),r.env.gain.exponentialRampToValueAtTime(.18,u+.01),r.env.gain.exponentialRampToValueAtTime(1e-4,u+t/2-.01),r.osc.frequency.setValueAtTime(v,u)}),P(i,t,o,(u,v)=>{s.env.gain.setValueAtTime(1e-4,u),s.env.gain.exponentialRampToValueAtTime(.12,u+.01),s.env.gain.exponentialRampToValueAtTime(1e-4,u+t-.02),s.osc.frequency.setValueAtTime(v,u)})},d*1e3)}function A(){H&&(clearInterval(H),H=0),z.forEach(e=>{try{e.stop()}catch{}try{e.disconnect()}catch{}}),z=[]}function V(e){if(!m||!k)return;const t=m.currentTime,c=m.createGain();c.gain.value=.18,c.connect(k);const n=m.createOscillator(),o=m.createBiquadFilter();o.type="lowpass",o.frequency.value=1800,n.connect(o),o.connect(c);const a=m.createGain();switch(a.gain.value=1e-4,o.connect(a),a.connect(c),e){case"rotate":n.type="square",n.frequency.setValueAtTime(540,t),n.frequency.exponentialRampToValueAtTime(880,t+.03);break;case"drop":n.type="triangle",n.frequency.setValueAtTime(220,t),n.frequency.exponentialRampToValueAtTime(90,t+.07);break;case"clear":n.type="sawtooth",n.frequency.setValueAtTime(660,t),n.frequency.exponentialRampToValueAtTime(990,t+.08);break;case"tetris":n.type="square",n.frequency.setValueAtTime(880,t),n.frequency.exponentialRampToValueAtTime(1320,t+.12);break;case"hold":n.type="sine",n.frequency.setValueAtTime(420,t),n.frequency.exponentialRampToValueAtTime(300,t+.08);break;case"gameover":n.type="sawtooth",n.frequency.setValueAtTime(330,t),n.frequency.exponentialRampToValueAtTime(55,t+.5),o.frequency.setValueAtTime(1200,t),o.frequency.exponentialRampToValueAtTime(200,t+.5);break}a.gain.setValueAtTime(1e-4,t),a.gain.exponentialRampToValueAtTime(.28,t+.01),a.gain.exponentialRampToValueAtTime(1e-4,t+(e==="gameover"?.55:.12)),n.start(t),n.stop(t+(e==="gameover"?.6:.14))}function de(e,t){if(!m||!S)throw new Error("audio not booted");const c=m.createOscillator();c.type=e;const n=m.createGain();return n.gain.value=1e-4,c.connect(n),n.connect(S),c.start(),{osc:c,env:n,level:t,oscs:[c]}}function Ze(e,t,c){if(!m||!S)throw new Error("audio not booted");const n=m.createGain();n.gain.value=1e-4,n.connect(S);const o=[];for(let a=0;a<c;a++){const r=m.createOscillator();r.type=e,r.connect(n),r.start(),o.push(r)}return{oscs:o,env:n,level:t}}function P(e,t,c,n){for(let o=0;o<c.length;o++)n(e+o*t,ye(c[o]))}function ye(e){const t=/^([A-G])(#?)(\d)$/.exec(e);if(!t)return 440;const c=t[1],n=t[2]==="#",o=Number(t[3]),a={C:0,D:2,E:4,F:5,G:7,A:9,B:11},r=440;let s=a[c]+(n?1:0);const l=(o+1)*12+s;return r*Math.pow(2,(l-69)/12)}function Xe(e,t,c){return Math.max(t,Math.min(c,e))}const je="/tetris-game-demo/assets/menumusic-DFLpY1NM.mp3",ze="/tetris-game-demo/assets/gamemusic-CGtAdK-L.mp3";let y=null,ue=null;function ne(e,t){if(e==="synth")return;if(e==="off"){T();return}const c=e==="menu_mp3"?je:ze;y||(y=new Audio,y.loop=!0,y.preload="auto"),y.volume=Qe(t,0,1),ue!==c&&(ue=c,y.src=c),y.play().catch(()=>{})}function T(){if(y)try{y.pause()}catch{}}function Qe(e,t,c){return Math.max(t,Math.min(c,e))}function et({router:e,settings:t}){const c=document.createElement("div");c.className=`screen game theme--${t.theme}`;const n=document.createElement("div");n.className="game__header",n.innerHTML=`
    <div class="brand">NEON TETRIS</div>
    <div class="meta">Z/X rotate · C hold · Space hard drop · Esc pause</div>
  `;const o=document.createElement("div");o.className="game__layout";const a=document.createElement("div");a.className="side";const r=document.createElement("div");r.className="side";const s=document.createElement("div");s.className="center";const l=document.createElement("div");l.className="board-wrap";const d=document.createElement("canvas");d.width=420,d.height=840,d.className="board";const i=document.createElement("div");i.className="overlay",l.append(d,i),s.append(l);const u=document.createElement("div");u.className="hud";const v=document.createElement("div");v.className="stats";const E=$("Score"),w=$("Lines"),b=$("Level"),R=$("Time");v.append(E.el,w.el,b.el,R.el);const x=me("Hold"),g=me("Next");a.append(x.el,v),r.append(g.el);const F=document.createElement("div");F.className="controls";const G=document.createElement("button");G.className="btn",G.textContent="Menu",G.addEventListener("click",()=>{A(),T(),N.stop(),e.go("menu")});const I=document.createElement("button");I.className="btn",I.textContent="Restart",I.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR"}))});const O=document.createElement("button");O.className="btn",O.textContent=t.musicEnabled||t.sfxEnabled?"Audio: On":"Audio: Off",O.addEventListener("click",()=>{if(t.musicEnabled=!t.musicEnabled,t.sfxEnabled=t.musicEnabled,O.textContent=t.musicEnabled?"Audio: On":"Audio: Off",!t.musicEnabled){A(),T();return}const f=t.volume/100;t.musicTrack==="synth"?(T(),ee(f),te()):(A(),ne("game_mp3",f))}),F.append(G,I,O),u.append(v,F),o.append(a,s,r),c.append(n,o);const U=d.getContext("2d"),N=We(t.mode,{dasMs:t.das,arrMs:t.arr},{onLineClear(f,p){t.sfxEnabled&&V(p?"tetris":"clear"),Te(p?"TETRIS!":`${f} LINE${f>1?"S":""}`)},onHardDrop(){t.sfxEnabled&&V("drop")},onRotate(){t.sfxEnabled&&V("rotate")},onMove(){},onHold(){t.sfxEnabled&&V("hold")},onGameOver(){t.sfxEnabled&&V("gameover"),Ae()}});(async()=>{if(await Q(),A(),T(),!t.musicEnabled)return;const f=t.volume/100;t.musicTrack==="synth"?(ee(f),te()):ne("game_mp3",f)})();let W=0;function re(f){const p=N.getState();p.__ghost=N.getGhost(p),E.value.textContent=String(p.score),w.value.textContent=String(p.lines),b.value.textContent=String(p.level),R.value.textContent=be(p.elapsedMs),x.draw(p.hold),g.draw(p.queue.slice(0,5)),i.classList.toggle("overlay--paused",p.status==="paused"),tt(U,p.board),nt(U,p),ct(U,p),p.status==="paused"?i.innerHTML='<div class="overlay__card"><div class="overlay__title">PAUSED</div><div class="overlay__sub">Press Esc to resume</div></div>':p.status!=="over"&&(i.dataset.locked||(i.innerHTML="")),W=requestAnimationFrame(re)}function Ae(){i.dataset.locked="1";const f=N.getState();i.innerHTML=`
      <div class="overlay__card">
        <div class="overlay__title">GAME OVER</div>
        <div class="overlay__sub">Score ${f.score} · Lines ${f.lines} · ${be(f.elapsedMs)}</div>
        <div class="overlay__actions">
          <button class="btn btn--primary" data-action="submit">Submit Score</button>
          <button class="btn" data-action="again">Play Again</button>
          <button class="btn" data-action="menu">Menu</button>
        </div>
      </div>
    `,i.querySelector('[data-action="again"]').addEventListener("click",()=>{i.dataset.locked="",window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR"}))}),i.querySelector('[data-action="menu"]').addEventListener("click",()=>{A(),T(),N.stop(),e.go("menu")}),i.querySelector('[data-action="submit"]').addEventListener("click",()=>{const p=prompt("Name for leaderboard?","PLAYER")?.slice(0,16)??"PLAYER";Je({name:p||"PLAYER",mode:f.mode,score:f.score,lines:f.lines,durationMs:Math.floor(f.elapsedMs),createdAt:Date.now()}),e.go("leaderboard")})}function Te(f){i.dataset.locked||(i.innerHTML=`<div class="toast">${f}</div>`,i.classList.remove("overlay--toast"),i.offsetWidth,i.classList.add("overlay--toast"),setTimeout(()=>{i.dataset.locked||(i.innerHTML="",i.classList.remove("overlay--toast"))},900))}return W=requestAnimationFrame(re),window.addEventListener("beforeunload",()=>{cancelAnimationFrame(W),N.stop(),A(),T()}),c}function $(e){const t=document.createElement("div");t.className="stat";const c=document.createElement("div");c.className="stat__label",c.textContent=e;const n=document.createElement("div");return n.className="stat__value",n.textContent="0",t.append(c,n),{el:t,value:n}}function me(e){const t=document.createElement("div");t.className="mini";const c=document.createElement("div");c.className="mini__title",c.textContent=e;const n=document.createElement("canvas");n.width=180,n.height=240,n.className="mini__canvas";const o=n.getContext("2d");t.append(c,n);function a(s){o.clearRect(0,0,n.width,n.height),s&&fe(o,s,0,0)}function r(s){o.clearRect(0,0,n.width,n.height),s.forEach((l,d)=>fe(o,l,0,d*44))}return{el:t,draw(s){Array.isArray(s)?r(s):a(s)}}}function fe(e,t,c,n){const o=D(t,0,0,0),a=Math.min(...o.map(i=>i.r)),r=Math.min(...o.map(i=>i.c)),s=24,l=c+18,d=n+18;for(const i of o){const u=i.r-a,v=i.c-r;B(e,l+v*s,d+u*s,s,K[t],.9)}}function tt(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height);const c=e.canvas.width/10;e.save(),e.globalAlpha=.2;for(let n=0;n<20;n++)for(let o=0;o<10;o++)e.strokeStyle="rgba(255,255,255,0.12)",e.strokeRect(o*c+.5,n*c+.5,c-1,c-1);e.restore();for(let n=0;n<20;n++)for(let o=0;o<10;o++){const a=t[n][o];a&&B(e,o*c,n*c,c,K[a],1)}}function nt(e,t){const c=e.canvas.width/10,n=t.__ghost;if(!n)return;const o=D(n.t,n.rot,n.r,n.c);for(const a of o)a.r<0||B(e,a.c*c,a.r*c,c,K[n.t],.25)}function ct(e,t){const c=e.canvas.width/10,n=t.active.t,o=D(n,t.active.rot,t.active.r,t.active.c);for(const a of o)a.r<0||B(e,a.c*c,a.r*c,c,K[n],1)}function B(e,t,c,n,o,a){e.save(),e.globalAlpha=a,e.shadowColor=o,e.shadowBlur=18;const r=2,s=n-r*2,l=e.createLinearGradient(t,c,t+n,c+n);l.addColorStop(0,ve(o,1.2)),l.addColorStop(1,ve(o,.9)),e.fillStyle=l,pe(e,t+r,c+r,s,s,8),e.fill(),e.shadowBlur=0,e.strokeStyle="rgba(255,255,255,0.28)",e.lineWidth=1,pe(e,t+r+.5,c+r+.5,s-1,s-1,8),e.stroke(),e.restore()}function pe(e,t,c,n,o,a){e.beginPath(),e.moveTo(t+a,c),e.arcTo(t+n,c,t+n,c+o,a),e.arcTo(t+n,c+o,t,c+o,a),e.arcTo(t,c+o,t,c,a),e.arcTo(t,c,t+n,c,a),e.closePath()}function ve(e,t){const c=e.replace("#",""),n=Y(Math.floor(parseInt(c.slice(0,2),16)*t),0,255),o=Y(Math.floor(parseInt(c.slice(2,4),16)*t),0,255),a=Y(Math.floor(parseInt(c.slice(4,6),16)*t),0,255);return`rgb(${n},${o},${a})`}function Y(e,t,c){return Math.max(t,Math.min(c,e))}function be(e){const t=Math.max(0,Math.floor(e/1e3)),c=Math.floor(t/60),n=t%60;return`${c}:${String(n).padStart(2,"0")}`}function ot({router:e,settings:t}){const c=document.createElement("div");c.className="screen menu",(async()=>{if(await Q(),A(),T(),!t.musicEnabled)return;const d=t.volume/100;t.musicTrack==="synth"?(ee(d),te()):ne("menu_mp3",d)})();const n=document.createElement("div");n.className="title",n.innerHTML=`
    <div class="title__top">NEON</div>
    <div class="title__main">TETRIS</div>
    <div class="title__sub">Production build · modes · audio · leaderboard</div>
  `;const o=document.createElement("div");o.className="panel";const a=document.createElement("button");a.className="btn btn--primary",a.textContent="PLAY",a.addEventListener("click",async()=>{await Q(),e.go("game")});const r=document.createElement("button");r.className="btn",r.textContent="OPTIONS",r.addEventListener("click",()=>e.go("settings"));const s=document.createElement("button");s.className="btn",s.textContent="LEADERBOARD",s.addEventListener("click",()=>e.go("leaderboard"));const l=document.createElement("div");return l.className="hint",l.innerHTML=`
    <div class="kbd">
      <div><span>Move</span><kbd>←</kbd><kbd>→</kbd></div>
      <div><span>Rotate</span><kbd>Z</kbd><kbd>X</kbd></div>
      <div><span>Soft/Hard</span><kbd>↓</kbd><kbd>Space</kbd></div>
      <div><span>Hold</span><kbd>C</kbd></div>
      <div><span>Pause</span><kbd>Esc</kbd></div>
    </div>
    <div class="small">Tip: click PLAY once to enable audio in-browser.</div>
  `,o.append(a,r,s),c.append(n,o,l),c}const Me="neon-tetris:settings:v1";function at(){const e=localStorage.getItem(Me);if(!e)return Z();try{const t=JSON.parse(e);return{...Z(),...t}}catch{return Z()}}function rt(e){localStorage.setItem(Me,JSON.stringify(e))}function Z(){return{mode:"marathon",theme:"neon",musicEnabled:!0,musicTrack:"synth",sfxEnabled:!0,volume:70,das:120,arr:20}}function st({router:e,settings:t}){const c=document.createElement("div");c.className="screen settings";const n=document.createElement("h2");n.textContent="Options";const o=document.createElement("div");o.className="form";const a=X("Mode",[{value:"marathon",label:"Marathon (recommended)"},{value:"sprint40",label:"Sprint 40 lines"},{value:"ultra2m",label:"Ultra 2 minutes"}]);a.value=t.mode;const r=X("Theme",[{value:"neon",label:"Neon"},{value:"aurora",label:"Aurora"},{value:"mono",label:"Mono"}]);r.value=t.theme;const s=he("Music",t.musicEnabled),l=X("Music track",[{value:"synth",label:"Synth (built-in)"},{value:"menu_mp3",label:"Menu MP3"},{value:"game_mp3",label:"Game MP3"}]);l.value=t.musicTrack;const d=he("SFX",t.sfxEnabled),i=j("Volume",0,100,t.volume,1),u=j("DAS (ms)",50,250,t.das,1),v=j("ARR (ms)",0,60,t.arr,1),E=document.createElement("button");E.className="btn",E.textContent="Back",E.addEventListener("click",()=>e.go("menu"));const w=document.createElement("button");w.className="btn btn--primary",w.textContent="Save",w.addEventListener("click",()=>{t.mode=a.value,t.theme=r.value,t.musicEnabled=s.input.checked,t.musicTrack=l.value,t.sfxEnabled=d.input.checked,t.volume=Number(i.value),t.das=Number(u.value),t.arr=Number(v.value),rt(t),e.go("menu")}),o.append(a.row,r.row,s.row,l.row,d.row,i.row,u.row,v.row);const b=document.createElement("div");return b.className="footer",b.append(E,w),c.append(n,o,b),c}function X(e,t){const c=document.createElement("div");c.className="row";const n=document.createElement("div");n.className="row__label",n.textContent=e;const o=document.createElement("select");o.className="select";for(const a of t){const r=document.createElement("option");r.value=a.value,r.textContent=a.label,o.append(r)}return c.append(n,o),Object.assign(o,{row:c})}function he(e,t){const c=document.createElement("div");c.className="row";const n=document.createElement("div");n.className="row__label",n.textContent=e;const o=document.createElement("input");o.type="checkbox",o.checked=t;const a=document.createElement("label");return a.className="toggle",a.append(o,document.createElement("span")),c.append(n,a),{row:c,input:o}}function j(e,t,c,n,o){const a=document.createElement("div");a.className="row";const r=document.createElement("div");r.className="row__label",r.textContent=e;const s=document.createElement("input");s.type="range",s.min=String(t),s.max=String(c),s.step=String(o),s.value=String(n);const l=document.createElement("div");return l.className="row__value",l.textContent=String(n),s.addEventListener("input",()=>l.textContent=s.value),a.append(r,s,l),Object.assign(s,{row:a})}function it({router:e}){const t=document.createElement("div");t.className="screen leaderboard";const c=document.createElement("h2");c.textContent="Leaderboard";const n=document.createElement("div");n.className="table";const o=ge(),a=document.createElement("div");if(a.className="table__row table__row--header",a.innerHTML="<div>#</div><div>Name</div><div>Mode</div><div>Score</div><div>Lines</div><div>Time</div>",n.append(a),o.slice(0,10).forEach((d,i)=>{const u=document.createElement("div");u.className="table__row",u.innerHTML=`<div>${i+1}</div><div>${dt(d.name)}</div><div>${d.mode}</div><div>${d.score}</div><div>${d.lines}</div><div>${lt(d.durationMs)}</div>`,n.append(u)}),o.length===0){const d=document.createElement("div");d.className="empty",d.textContent="No scores yet. Play a game to set your first record.",n.append(d)}const r=document.createElement("div");r.className="footer";const s=document.createElement("button");s.className="btn",s.textContent="Back",s.addEventListener("click",()=>e.go("menu"));const l=document.createElement("button");return l.className="btn",l.textContent="Reset",l.addEventListener("click",()=>{Ye(),e.go("leaderboard")}),r.append(s,l),t.append(c,n,r),t}function lt(e){const t=Math.max(0,Math.floor(e/1e3)),c=Math.floor(t/60),n=t%60;return`${c}:${String(n).padStart(2,"0")}`}function dt(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ut(e){let t="menu";function c(n){t=n,history.pushState({route:n},"",n==="menu"?"/":`/${n}`),e.mount(n)}return window.addEventListener("popstate",n=>{const o=(n.state?.route??(location.pathname.replace("/","")||"menu"))||"menu";t=o,e.mount(o)}),{go:c,get current(){return t}}}function mt(e){e.innerHTML="",e.classList.add("app-root");const t=at(),c=document.createElement("div");c.className="app-shell";const n=document.createElement("div");n.className="bg";const o=document.createElement("div");o.className="crt";const a=document.createElement("div");a.className="view",c.append(n,o,a),e.append(c);const r=ut({mount(s){switch(a.innerHTML="",s){case"menu":a.append(ot({router:r,settings:t}));break;case"game":a.append(et({router:r,settings:t}));break;case"settings":a.append(st({router:r,settings:t}));break;case"leaderboard":a.append(it({router:r}));break}}});r.go("menu")}mt(document.querySelector("#app"));
